#! /bin/sh

set -e

add_kolab_system_users() {
	if ! getent passwd kolab >/dev/null; then
		adduser --group --system --no-create-home --gecos "Kolab user" \
			--home /var/lib/kolab kolab
	fi
}

fixperms() {
	chown kolab:kolab /var/lib/kolab
	chmod 2775 /var/lib/kolab
}

create_cachefiles() {
	if ! [ -f /var/lib/kolab/mailbox-uidcache.db ] ; then
		echo "Creating Mailbox UID cache file"
		/usr/sbin/kolabdcachetool mbox flush
	fi
	if ! [ -f /var/lib/kolab/graveyard-tscache.db ] ; then
		echo "Creating Graveyard files"
		/usr/sbin/kolabdcachetool gyard flush
	fi
}

if [ "$1" = configure ]; then
	add_kolab_system_users
	fixperms
	create_cachefiles
fi

#DEBHELPER#
